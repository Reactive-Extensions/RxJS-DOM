/*
 Copyright (c) Microsoft Corporation.  All rights reserved.
 This code is licensed by Microsoft Corporation under the terms
 of the MICROSOFT REACTIVE EXTENSIONS FOR JAVASCRIPT AND .NET LIBRARIES License.
 See http://go.microsoft.com/fwlink/?LinkID=220762.
*/
(function(G,p){var t;t="undefined"!==typeof exports?require("./rx.min"):G.Rx;var u=t.Observable,o=u.prototype,l=u.createWithDisposable,x=u.defer,H=u.empty,y=u.throwException,n=t.Scheduler.Timeout,q=t.SingleAssignmentDisposable,s=t.SerialDisposable,r=t.CompositeDisposable,z=t.RefCountDisposable,v=t.Subject,I=t.Internals.BinaryObserver,w=function(a,c){return l(function(b){return new r(c.getDisposable(),a.subscribe(b))})},J=function(a,c,b){return l(function(d){var e=new q,f=new q,d=b(d,e,f);e.disposable(a.materialize().select(function(c){return{switchValue:function(a){return a(c)}}}).subscribe(d));
f.disposable(c.materialize().select(function(c){return{switchValue:function(a,b){return b(c)}}}).subscribe(d));return new r(e,f)})},K=function(a,c){return l(function(b){return c.scheduleWithAbsolute(a,function(){b.onNext(0);b.onCompleted()})})},A=function(a,c,b){var d=0>c?0:c;return l(function(c){var f=0,h=a;return b.scheduleRecursiveWithAbsolute(h,function(a){var i;0<d&&(i=b.now(),h+=d,h<=i&&(h=i+d));c.onNext(f++);a(h)})})},L=function(a,c){var b=0>a?0:a;return l(function(a){return c.scheduleWithRelative(b,
function(){a.onNext(0);a.onCompleted()})})},B=function(a,c,b){return x(function(){return A(b.now()+a,c,b)})},M=u.interval=function(a,c){c||(c=n);return B(a,a,c)},N=u.timer=function(a,c,b){var d;b||(b=n);c!==p&&"number"===typeof c?d=c:c!==p&&"object"===typeof c&&(b=c);return a instanceof Date&&d===p?K(a.getTime(),b):a instanceof Date&&d!==p?A(a.getTime(),c,b):d===p?L(a,b):B(a,d,b)},E=function(a,c){var b=this;return l(function(d){var e=!1,f=new s,h=null,g=[],i=!1,j;j=b.materialize().timestamp(c).subscribe(function(b){"E"===
b.value.kind?(g=[],g.push(b),h=b.value.exception,b=!i):(g.push({value:b.value,timestamp:b.timestamp+a}),b=!e,e=!0);if(b)if(null!==h)d.onError(h);else b=new q,f.disposable(b),b.disposable(c.scheduleRecursiveWithRelative(a,function(b){var a,f,j;if(h===null){i=true;do{a=null;if(g.length>0&&g[0].timestamp-c.now()<=0)a=g.shift().value;a!==null&&a.accept(d)}while(a!==null);j=false;f=0;if(g.length>0){j=true;f=Math.max(0,g[0].timestamp-c.now())}else e=false;a=h;i=false;if(a!==null)d.onError(a);else j&&b(f)}}))});
return new r(j,f)})},O=function(a,c){var b=this;return x(function(){var d=a-c.now();return E.call(b,d,c)})};o.delay=function(a,c){c||(c=n);return a instanceof Date?O.call(this,a.getTime(),c):E.call(this,a,c)};o.throttle=function(a,c){c||(c=n);var b=this;return l(function(d){var e=new s,f=!1,h=0,g,i=null;g=b.subscribe(function(b){var g;f=!0;i=b;h++;g=h;b=new q;e.disposable(b);b.disposable(c.scheduleWithRelative(a,function(){if(f&&h===g)d.onNext(i);f=!1}))},function(b){e.dispose();d.onError(b);f=!1;
h++},function(){e.dispose();if(f)d.onNext(i);d.onCompleted();f=!1;h++});return new r(g,e)})};o.windowWithTime=function(a,c,b){var d=this,e;c===p&&(e=a);b===p&&(b=n);"number"===typeof c?e=c:"object"===typeof c&&(e=a,b=c);return l(function(c){var h,g,i=e,j=a,k=[],m,C=new s,D=0;g=new r(C);m=new z(g);h=function(){var a,d,g,l,n;g=new q;C.disposable(g);a=d=false;if(j===i)a=d=true;else j<i?d=true:a=true;l=d?j:i;n=l-D;D=l;d&&(j=j+e);a&&(i=i+e);g.disposable(b.scheduleWithRelative(n,function(){var b;if(a){b=
new v;k.push(b);c.onNext(w(b,m))}if(d){b=k.shift();b.onCompleted()}h()}))};k.push(new v);c.onNext(w(k[0],m));h();g.add(d.subscribe(function(b){var a,c;for(a=0;a<k.length;a++){c=k[a];c.onNext(b)}},function(b){var a,d;for(a=0;a<k.length;a++){d=k[a];d.onError(b)}c.onError(b)},function(){var a,b;for(a=0;a<k.length;a++){b=k[a];b.onCompleted()}c.onCompleted()}));return m})};o.windowWithTimeOrCount=function(a,c,b){var d=this;b||(b=n);return l(function(e){var f,h,g=0,i,j,k=new s,m=0;h=new r(k);i=new z(h);
f=function(c){var d=new q;k.disposable(d);d.disposable(b.scheduleWithRelative(a,function(){var a;c===m&&(g=0,a=++m,j.onCompleted(),j=new v,e.onNext(w(j,i)),f(a))}))};j=new v;e.onNext(w(j,i));f(0);h.add(d.subscribe(function(a){var b=0,d=!1;j.onNext(a);g++;g===c&&(d=!0,g=0,b=++m,j.onCompleted(),j=new v,e.onNext(w(j,i)));d&&f(b)},function(a){j.onError(a);e.onError(a)},function(){j.onCompleted();e.onCompleted()}));return i})};o.bufferWithTime=function(a,c,b){var d;c===p&&(d=a);b||(b=n);"number"===typeof c?
d=c:"object"===typeof c&&(d=a,b=c);return this.windowWithTime(a,d,b).selectMany(function(a){return a.toArray()})};o.bufferWithTimeOrCount=function(a,c,b){b||(b=n);return this.windowWithTimeOrCount(a,c,b).selectMany(function(a){return a.toArray()})};o.timeInterval=function(a){var c=this;a||(a=n);return x(function(){var b=a.now();return c.select(function(c){var e=a.now(),f=e-b;b=e;return{value:c,interval:f}})})};o.timestamp=function(a){a||(a=n);return this.select(function(c){return{value:c,timestamp:a.now()}})};
var F=function(a,c){return J(a,c,function(a){var c=!1,e;return new I(function(f){"N"===f.kind&&(e=f);"E"===f.kind&&f.accept(a);"C"===f.kind&&(c=!0)},function(){var f=e;e=p;f!==p&&f.accept(a);if(c)a.onCompleted()})})};o.sample=function(a,c){c||(c=n);return"number"===typeof a?F(this,M(a,c)):F(this,a)};o.timeout=function(a,c,b){var d,e=this;c===p&&(c=y(Error("Timeout")));b||(b=n);d=a instanceof Date?function(a,c){b.scheduleWithAbsolute(a,c)}:function(a,c){b.scheduleWithRelative(a,c)};return l(function(b){var h,
g=0,i=new q,j=new s,k=!1,m=new s;j.disposable(i);h=function(){var e=g;m.disposable(d(a,function(){(k=g===e)&&j.disposable(c.subscribe(b))}))};h();i.disposable(e.subscribe(function(a){k||(g++,b.onNext(a),h())},function(a){k||(g++,b.onError(a))},function(){k||(g++,b.onCompleted())}));return new r(j,m)})};u.generateWithAbsoluteTime=function(a,c,b,d,e,f){f||(f=n);return l(function(h){var g=!0,i=!1,j,k=a,m;return f.scheduleRecursiveWithAbsolute(f.now(),function(a){if(i)h.onNext(j);try{if(g?g=!1:k=b(k),
i=c(k))j=d(k),m=e(k)}catch(f){h.onError(f);return}if(i)a(m);else h.onCompleted()})})};u.generateWithRelativeTime=function(a,c,b,d,e,f){f||(f=n);return l(function(h){var g=!0,i=!1,j,k=a,m;return f.scheduleRecursiveWithRelative(0,function(a){if(i)h.onNext(j);try{if(g?g=!1:k=b(k),i=c(k))j=d(k),m=e(k)}catch(f){h.onError(f);return}if(i)a(m);else h.onCompleted()})})};o.delaySubscription=function(a,c){c||(c=n);return this.delayWithSelector(N(a,c),function(){return H()})};o.delayWithSelector=function(a,c){var b=
this;return l(function(d){var e=new r,f=!1,h=function(){if(f&&0===e.length)d.onCompleted()},g=new s,i=function(){g.setDisposable(b.subscribe(function(a){var b;try{b=c(a)}catch(f){d.onError(f);return}var g=new q;e.add(g);g.setDisposable(b.subscribe(function(){d.onNext(a);e.remove(g);h()},function(a){d.onError(a)},function(){d.onNext(a);e.remove(g);h()}))},function(a){d.onError(a)},function(){f=!0;g.dispose();h()}))};a?g.setDisposable(a.subscribe(function(){i()},function(a){d.onError(a)},function(){i()})):
i();return new r(g,e)})};o.timeoutWithSelector=function(a,c,b){a||(a=observableNever());b||(b=y(Error("Timeout")));var d=this;return l(function(e){var f=new s,h=new s,g=new q;f.setDisposable(g);var i=0,j=function(a){var c=i,d=new q;h.setDisposable(d);d.setDisposable(a.subscribe(function(){i===c&&f.setDisposable(b.subscribe(e));d.dispose()},function(a){if(i===c)e.onError(a)},function(){i===c&&f.setDisposable(b.subscribe(e))}))};j(a);var k=function(){i++;return!0};g.setDisposable(d.subscribe(function(a){if(k()){e.onNext(a);
var b;try{b=c(a)}catch(d){e.onError(d);return}j(b)}},function(a){if(k())e.onError(a)},function(){if(k())e.onCompleted()}));return new r(f,h)})};o.throttleWithSelector=function(a){var c=this;return l(function(b){var d,e=!1,f=new s,h=0,g=c.subscribe(function(c){var g;try{g=a(c)}catch(k){b.onError(k);return}e=!0;d=c;h++;var m=h,l=new q;f.setDisposable(l);l.setDisposable(g.subscribe(function(){if(e&&h===m)b.onNext(d);e=!1;l.dispose()},function(a){b.onError(a)},function(){if(e&&h===m)b.onNext(d);e=!1;
l.dispose()}))},function(a){f.dispose();b.onError(a);e=!1;h++},function(){f.dispose();if(e)b.onNext(d);b.onCompleted();e=!1;h++});return new r(g,f)})}})(this);